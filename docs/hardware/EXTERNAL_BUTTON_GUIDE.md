# ESP32-S3小智语音助手 - 外部按钮连接指南

## 🔌 硬件连接

### 所需材料
- ESP32-S3-N8R2开发板
- 轻触按钮开关（常开型）
- 杜邦线 x 2根

### 连接方式

```
ESP32-S3开发板          轻触按钮
┌─────────────┐         ┌─────┐
│             │         │     │
│    GPIO1    ├─────────┤  1  │
│             │         │     │
│     GND     ├─────────┤  2  │
│             │         │     │
└─────────────┘         └─────┘
```

### 详细连接步骤

1. **GPIO1连接**
   - 使用杜邦线连接ESP32-S3的GPIO1引脚到按钮的一端
   - GPIO1引脚位置：查看开发板引脚图

2. **GND连接**
   - 使用杜邦线连接ESP32-S3的GND引脚到按钮的另一端
   - 任意一个GND引脚均可

3. **无需额外电阻**
   - 代码中已配置内部上拉电阻
   - 按钮默认状态为HIGH
   - 按下时为LOW

## 🎛️ 工作原理

### 电路原理
```
3.3V ──[内部上拉电阻]── GPIO1 ──[按钮]── GND
```

- **未按下**：GPIO1 = HIGH (3.3V)
- **按下时**：GPIO1 = LOW (0V)
- **防抖处理**：50ms防抖延时，避免误触发

### 状态指示

**LED状态指示（GPIO48）：**
- 🟢 **常亮**：正在录音，请说话
- 🔴 **快速闪烁**：正在播放AI回复或发生错误
- 🟡 **慢速闪烁**：服务未就绪（WiFi未连接或AI未初始化）
- ⚫ **熄灭**：待机状态

## 🎤 使用方法

### 基本操作
1. **确保系统就绪**
   - WiFi已连接
   - AI服务已初始化
   - 百度语音服务已就绪

2. **开始语音对话**
   - 短按外部按钮
   - LED常亮表示开始录音
   - 对着麦克风说话（5秒录音时间）
   - LED闪烁表示AI正在处理和播放回复

### 系统检查命令

通过串口输入以下命令：

```bash
# 测试按钮状态
button

# 模拟按钮按下
testbutton

# 查看系统状态
status

# 查看帮助信息
help
```

## 🔧 故障排除

### 按钮无响应
1. **检查连接**
   - 确认GPIO1和GND连接正确
   - 检查杜邦线是否接触良好

2. **检查系统状态**
   - 串口输入 `status` 查看系统状态
   - 确保WiFi已连接，AI服务已就绪

3. **测试按钮**
   - 串口输入 `button` 查看按钮状态
   - 按下按钮时应该看到状态变化

### LED状态异常
- **快速闪烁**：WiFi未连接，检查网络设置
- **慢速闪烁**：AI服务未就绪，等待初始化完成
- **不亮**：系统可能死机，按RESET重启

### 语音功能异常
1. **录音问题**
   - 检查麦克风连接（GPIO45/21/47）
   - 确保录音时LED常亮

2. **播放问题**
   - 检查功放连接（GPIO42/41/40）
   - 确保播放时LED闪烁

## 📋 系统配置

### 当前配置参数
```cpp
// 按钮配置
#define BUTTON_PIN        GPIO_NUM_1    // 外部按钮引脚
#define BUTTON_DEBOUNCE   50            // 防抖延时(ms)

// LED配置
#define LED_PIN           GPIO_NUM_48   // 状态指示LED

// 语音配置
#define SILENCE_TIMEOUT   3000          // 静默超时(ms)
#define MIN_RECORD_TIME   1000          // 最小录音时间(ms)
#define MAX_RECORD_TIME   10000         // 最大录音时间(ms)
```

### 引脚占用情况
```
GPIO1  - 外部按钮输入
GPIO48 - 状态LED输出
GPIO45 - I2S麦克风WS
GPIO21 - I2S麦克风SCK
GPIO47 - I2S麦克风SD
GPIO42 - I2S功放WS
GPIO41 - I2S功放SCK
GPIO40 - I2S功放SD
```

## 🎯 最佳实践

### 按钮使用建议
1. **短按操作**：快速按下并释放，避免长按
2. **等待指示**：按下后等待LED状态变化确认系统响应
3. **避免连续按压**：等待当前对话结束后再次按下

### 语音对话技巧
1. **清晰发音**：对着麦克风清晰说话
2. **适当距离**：距离麦克风10-30cm
3. **安静环境**：减少背景噪音干扰

### 系统维护
1. **定期重启**：长时间运行后可重启刷新系统
2. **监控内存**：通过串口 `status` 命令检查内存使用
3. **网络稳定**：确保WiFi连接稳定

---

## 📞 技术支持

如果遇到问题，可以：
1. 查看串口输出的详细日志
2. 使用 `help` 命令查看所有可用命令
3. 使用 `status` 命令检查系统状态
4. 重启设备或重新上传固件

祝您使用愉快！🎉
